## 1. 配置文件的格式

与在命令行中指定启动选项不同的是

配置文件中的启动选项被划分为若干个组，每个组有一个组名，用中括号`[]`扩起来

```properties
[server]
(具体的启动选项...)

[mysqld]
(具体的启动选项...)

[mysqld_safe]
(具体的启动选项...)

[client]
(具体的启动选项...)

[mysql]
(具体的启动选项...)

[mysqladmin]
(具体的启动选项...)
```

像这个配置文件里就定义了许多个组，组名分别是`server`、`mysqld`、`mysqld_safe`、`client`、`mysql`、`mysqladmin`。每个组下边可以定义若干个启动选项。

以[server]组为例来看一下填写启动选项的形式（其他组中启动选项的形式是一样的）

```properties
[server]
# 这是option1，该选项不需要选项值
option1
# 这是option2，该选项需要选项值
option2=value2
```

在配置文件中指定启动选项的语法类似于命令行语法，但是配置文件中指定的启动选项不允许加`--`前缀，并且每行只指定一个选项，而且`=`周围可以有空白字符（命令行中选项名、`=`、选项值之间不允许有空白字符）。另外，在配置文件中，我们可以使用`#`来添加注释，从`#`开始直到行尾的内容都属于注释内容，读取配置文件时会忽略这些注释内容。

## 2. 启动命令与选项组

配置文件中不同的选项组是给不同的启动命令使用的。不过有两个选项组比较特别：

- `[server]` 组下边的启动选项将作用于 `所有的服务器` 程序。
- `[client]` 组下边的启动选项将作用于 `所有的客户端` 程序。

下面是启动命令能读取的选项组都有那些：

| 启动命令     | 类别       | 能读取的组                         |
| ------------ | ---------- | ---------------------------------- |
| mysqld       | 启动服务器 | [mysqld]、[server]                 |
| mysqld_safe  | 启动服务器 | [mysqld]、[server]、[mysqld_safe]  |
| mysql.server | 启动服务器 | [mysqld]、[server]、[mysql.server] |
| mysql        | 启动客户端 | [mysql]、[client]                  |
| mysqladmin   | 启动客户端 | [mysqladmin]、[client]             |
| mysqldump    | 启动客户端 | [mysqldump]、[client]              |

比如，在 `/etc/mysql/my.cnf` 这个配置文件中添加一些内容：

```properties
[server]
skip-networking
default-storage-engine=MyISAM
```

然后直接使用 `mysqld` 启动服务器程序：

```bash
mysqld
```

虽然启动命令行没有添加启动选项，但是在程序启动的时候，就会到默认的配置文件路径下查找配置文件，其中就包括 `/etc/my.cnf`。 由于 `mysqld` 命令可以读取 `[server]` 选项组的内容，所以 `skip-networking` 和 `default-storage-engine=MyISAM` 这两个选项是生效的。如果把这些启动选项放在 `[client]` 组里再试试用 `mysqld` 启动服务器程序，就不生效。

## 3. 特定MySQL版本的专用选项组

可以在选项组的名称后加上特定的 MySQL 版本号，比如对于 `[mysqld]` 选项组来说，我们可以定义一个 `[mysqld-5.7]` 的选项组，它的含义和 `[mysqld]` 一样，只不过只有版本号为 5.7 的 `mysqld` 程序才能使用这个选项组中的选项。

## 4. 同一个配置文件中多个组的优先级

同一个命令可以访问配置文件中的多个组，比如 `mysqld` 可以访问 `[mysqld]`、 `[server]` 组，如果在同一个配置文件中，比如 `~/.my.cnf`，存在这些组里出现了同样的配置项，比如这样：

```properties
[server]
default-storage-engine=InnoDB

[mysqld]
default-storage-engine=MyISAM
```

那么，以最后一个出现的组中的启动选项为准，比方说例子中 `default-storage-engine` 既出现在 `[mysqld]` 组也出现在 `[server]` 组，因为 `[mysqld]` 组在 `[server]` 组之后，就以 `[mysqld]` 组的配置项为准。

## 5. 命令行和配置文件中启动选项的区别

在命令行上指定的绝大部分启动选项都可以放到配置文件中，但是有一些选项是专门为命令行设计的，比如说 `defaults-extra-file`、 `defaults-file` 这样的选项本身就是为了指定配置文件路径的，再放在配置文件中使用就没有意义了。

如果同一个启动选项出现在命令行中，又出现在配置文件中，那么以**命令行中的启动选项为准**

比如在配置文件中写了：

```properties
[server]
default-storage-engine=InnoDB
```

而启动命令行是：

```bash
mysql.server start --default-storage-engine=MyISAM
```

最后的 `default-storage-engine` 的值将是 `MyISAM`。
